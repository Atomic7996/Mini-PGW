# Mini-PGW — Выпускная работа IT-школы Протей по C++

Mini-PGW — упрощённая модель сетевого компонента PGW (Packet Gateway), способная обрабатывать UDP-запросы, управлять сессиями абонентов по IMSI, вести CDR-журнал, предоставлять HTTP API, поддерживать чёрный список IMSI и корректно завершать работу.
Проект состоит из серверного и клиентского приложений.

## Функции системы

### Серверная часть
Сервер построен на многопоточной архитектуре и состоит из следующих потоков:
- UDP-поток: отвечает за прием UDP-пакетов, извлечение IMSI, проверку черного списка, создание сессий и отправку ответов клиентам;
- HTTP-поток: предоставляет HTTP API для проверки статуса абонента и корректной остановки сервера;
- поток удаления сессий: отвечает за удаление устаревших сессий и корректное завершение работы сервера.

Дополнительные функции:
- логирование действий в консоль и файлы;
- конфигурация сервера загружается из JSON-файла.

### Клиентская часть
Простой клиент, который отправляет UDP-пакеты, содержащие IMSI, на сервер и получает ответ.
Клиент выполняет следующие функции:
- отправка UDP-пакетов с IMSI на сервер;
- получение и вывод ответа от сервера («created» или «rejected»);
- логирование действий в консоль и файл;
- конфигурация клиента загружается из JSON-файла.

### Логирование
- использование spdlog для настраиваемого логирования как в консоль, так и в локальные файлы;
- поддержка уровней INFO и DEBUG, с возможностью включения режима отладки через файл конфигурации.

## Среда для запуска
- разработано под ОС Linux;
- сборка через CMake;
- зависимости (автоматически устанавливаются через CMake):
  - nlohmann_json,
  - cpp-httplib,
  - spdlog,
  - googletest.

## Запуск сервера
Команда для запуска сервера (из build):

```bash
./src/server/mini_pgw_server <server_config.json>
```

## Запуск клиента
Команда для запуска клиента (из build):

```bash
./src/client/mini_pgw_client <client_config.json> <IMSI>
```

## Использование HTTP API
Поддерживаемые HTTP endpoints:

1. Проверка статуса абонента:
   ```bash
   curl http://127.0.0.1:8080/check_subscriber?imsi=<IMSI>
   ```
   Возвращает "active", если у IMSI есть активная сессия, "not active" в ином случае.

2. Плавное завершение работы:
   ```bash
   curl http://127.0.0.1:8080/stop
   ```
   Инициирует завершение работы сервера, удаляя сессии с заданной в конфиге скоростью.
